<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Avispones Scoreboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  text-align: center;
  background: #0b6b3a;
  color: white;
  margin: 0;
  padding: 20px;
}

h1 { margin-bottom: 10px; }

input, select {
  padding: 8px;
  font-size: 16px;
  border-radius: 8px;
  border: none;
  text-align: center;
  margin: 5px;
}

.score-container {
  display: flex;
  justify-content: space-around;
  margin: 30px 0;
  flex-wrap: wrap;
}

.team {
  background: white;
  color: #0b6b3a;
  padding: 20px;
  border-radius: 15px;
  width: 300px;
  margin: 10px;
}

.score {
  font-size: 70px;
  margin: 20px 0;
}

button {
  padding: 10px 15px;
  font-size: 18px;
  margin: 5px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
}

.add1 { background: #28a745; color: white; }
.add6 { background: #14532d; color: white; }
.sub { background: #dc3545; color: white; }
.export-btn { background: #ffc107; color: black; margin-top: 20px; }
.reset-btn { background: black; color: white; margin-top: 10px; }
</style>
</head>

<body>

<h1>Avispones Scoreboard</h1>

<!-- CATEGORY -->
<div>
  <input 
    type="text" 
    id="categoryName" 
    placeholder="Category (e.g. U12, Senior, Liga MX)"
    oninput="saveState()"
  >
</div>

<!-- MATCH SELECTOR -->
<div style="margin-bottom:20px;">
  <select id="jornadaSelect" onchange="handleJornadaChange()">
    <option value="">Select Match</option>
    <option>Jornada 1</option>
    <option>Jornada 2</option>
    <option>Jornada 3</option>
    <option>Jornada 4</option>
    <option>Jornada 5</option>
    <option>Quarterfinal</option>
    <option>Semifinal</option>
    <option>Final</option>
    <option value="custom">Custom...</option>
  </select>

  <input 
    type="text" 
    id="customJornada" 
    placeholder="Enter custom match name"
    style="display:none;"
    oninput="saveState()"
  >
</div>

<div class="score-container">

  <div class="team">
    <h2>Avispones</h2>
    <div class="score" id="avisponesScore">0</div>
    <button class="add1" onclick="updateScore('avispones',1)">+1</button>
    <button class="add6" onclick="updateScore('avispones',6)">+6</button>
    <button class="sub" onclick="updateScore('avispones',-1)">-1</button>
  </div>

  <div class="team">
    <input type="text" id="opponentName" placeholder="Opponent Name" oninput="saveState()">
    <div class="score" id="opponentScore">0</div>
    <button class="add1" onclick="updateScore('opponent',1)">+1</button>
    <button class="add6" onclick="updateScore('opponent',6)">+6</button>
    <button class="sub" onclick="updateScore('opponent',-1)">-1</button>
  </div>

</div>

<button class="export-btn" onclick="exportScore()">Export Score Image</button>
<br>
<button class="reset-btn" onclick="resetGame()">Reset Game</button>

<script>

let avisponesScore = 0;
let opponentScore = 0;

// LOAD
window.onload = function() {
  const saved = JSON.parse(localStorage.getItem("avisponesGame"));
  if (saved) {
    avisponesScore = saved.avispones || 0;
    opponentScore = saved.opponent || 0;

    document.getElementById("avisponesScore").textContent = avisponesScore;
    document.getElementById("opponentScore").textContent = opponentScore;
    document.getElementById("opponentName").value = saved.opponentName || "";
    document.getElementById("categoryName").value = saved.categoryName || "";
    document.getElementById("jornadaSelect").value = saved.jornadaSelect || "";
    document.getElementById("customJornada").value = saved.customJornada || "";

    if (saved.jornadaSelect === "custom") {
      document.getElementById("customJornada").style.display = "inline-block";
    }
  }
};

// SAVE
function saveState() {
  const data = {
    avispones: avisponesScore,
    opponent: opponentScore,
    opponentName: document.getElementById("opponentName").value,
    categoryName: document.getElementById("categoryName").value,
    jornadaSelect: document.getElementById("jornadaSelect").value,
    customJornada: document.getElementById("customJornada").value
  };
  localStorage.setItem("avisponesGame", JSON.stringify(data));
}

function handleJornadaChange() {
  const select = document.getElementById("jornadaSelect");
  const customInput = document.getElementById("customJornada");

  if (select.value === "custom") {
    customInput.style.display = "inline-block";
  } else {
    customInput.style.display = "none";
    customInput.value = "";
  }

  saveState();
}

function getJornadaText() {
  const select = document.getElementById("jornadaSelect");
  const customInput = document.getElementById("customJornada");

  if (select.value === "custom") {
    return customInput.value || "PARTIDO";
  }

  return select.value || "PARTIDO";
}

// UPDATE SCORE
function updateScore(team, value) {
  if (team === "avispones") {
    avisponesScore = Math.max(0, avisponesScore + value);
    document.getElementById("avisponesScore").textContent = avisponesScore;
  } else {
    opponentScore = Math.max(0, opponentScore + value);
    document.getElementById("opponentScore").textContent = opponentScore;
  }
  saveState();
}

// RESET
function resetGame() {
  if (confirm("Reset the game?")) {
    avisponesScore = 0;
    opponentScore = 0;
    localStorage.removeItem("avisponesGame");
    location.reload();
  }
}

// EXPORT
function exportScore() {

  const canvas = document.createElement("canvas");
  canvas.width = 1080;
  canvas.height = 1080;
  const ctx = canvas.getContext("2d");

  const gradient = ctx.createLinearGradient(0, 0, 0, 1080);
  gradient.addColorStop(0, "#F6D365");
  gradient.addColorStop(0.5, "#D4AF37");
  gradient.addColorStop(1, "#A67C00");
  ctx.fillStyle = gradient;
  ctx.fillRect(0, 0, 1080, 1080);

  const logo = new Image();
  logo.src = "logo.PNG";

  logo.onload = function() {

    const desiredWidth = 400;
    const scale = desiredWidth / logo.width;
    const newHeight = logo.height * scale;
    const xPosition = (1080 - desiredWidth) / 2;

    ctx.save();
    ctx.shadowColor = "rgba(0,0,0,0.35)";
    ctx.shadowBlur = 40;
    ctx.shadowOffsetY = 15;
    ctx.drawImage(logo, xPosition, 90, desiredWidth, newHeight);
    ctx.restore();

    ctx.fillStyle = "white";
    ctx.textAlign = "center";

    // CATEGORY
    const category = document.getElementById("categoryName").value || "CATEGORÍA";
    ctx.font = "bold 45px Arial";
    ctx.fillText(category.toUpperCase(), 540, 550);

    // JORNADA
    ctx.font = "bold 50px Arial";
    ctx.fillText(getJornadaText().toUpperCase(), 540, 610);

    // MARCADOR FINAL
    ctx.font = "bold 70px Arial";
    ctx.fillText("MARCADOR FINAL", 540, 690);

    // SCORES
    ctx.font = "bold 90px Arial";
    ctx.fillText("AVISPONES " + avisponesScore, 540, 830);

    const opponentName =
      document.getElementById("opponentName").value || "RIVAL";

    ctx.fillText(opponentName.toUpperCase() + " " + opponentScore, 540, 960);

    // DATE
    const now = new Date();
    ctx.font = "40px Arial";
    ctx.fillText(
      now.toLocaleDateString() + " • " +
      now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
      540,
      1030
    );

    canvas.toBlob(async function(blob) {

      const file = new File([blob], "avispones-marcador-final.PNG", {
        type: "image/png"
      });

      if (navigator.share && navigator.canShare({ files: [file] })) {
        await navigator.share({
          files: [file],
          title: "Avispones Marcador Final"
        });
      } else {
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "avispones-marcador-final.PNG";
        link.click();
      }

    }, "image/png");

  };

}

</script>

</body>
</html>
