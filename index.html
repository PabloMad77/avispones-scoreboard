<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Avispones Scoreboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:Arial,sans-serif;
  text-align:center;
  background:#111000;
  color:white;
  margin:0;
  padding:20px;
}

h1{margin-bottom:10px;color:#facc15;}

input,select{
  padding:8px;
  font-size:18px;
  border-radius:8px;
  border:none;
  text-align:center;
  margin:5px;
}

.score-container{
  display:flex;
  justify-content:space-around;
  margin:30px 0;
  flex-wrap:wrap;
}

.team{
  background:#facc15;
  color:black;
  padding:20px;
  border-radius:15px;
  width:300px;
  margin:10px;
}

.score{
  font-size:70px;
  margin:20px 0;
}

button{
  padding:10px 15px;
  font-size:18px;
  margin:5px;
  border-radius:10px;
  border:none;
  cursor:pointer;
  transition:transform 0.08s ease, box-shadow 0.08s ease;
}

button:active{transform:scale(0.92);}

.flash{animation:flashEffect 0.25s ease;}

@keyframes flashEffect{
  0%{box-shadow:0 0 0 rgba(255,255,255,0);}
  50%{box-shadow:0 0 20px rgba(255,255,255,0.7);}
  100%{box-shadow:0 0 0 rgba(255,255,255,0);}
}

.add1{background:#16a34a;color:white;}
.add6{background:#b91c1c;color:white;}
.sub{background:#dc2626;color:white;}
.export-btn{background:#facc15;color:black;margin-top:20px;}
.reset-btn{background:#333;color:white;margin-top:10px;}

.stats-box{
  margin-top:40px;
  padding:20px;
  border:1px solid #444;
  border-radius:12px;
}
</style>
</head>

<body>

<h1>üêù Avispones Scoreboard</h1>

<input type="text" id="categoryInput" placeholder="Category (U10, U14...)">
<input type="text" id="jornadaInput" placeholder="Jornada / Game Week">

<div class="score-container">

  <div class="team">
    <h2>Avispones</h2>
    <div class="score" id="homeScore">0</div>
    <button class="add1" onclick="updateScore('home',1,this)">+1</button>
    <button class="add6" onclick="updateScore('home',6,this)">+6</button>
    <button class="sub" onclick="updateScore('home',-1,this)">-1</button>
  </div>

  <div class="team">
    <input type="text" id="opponentName" placeholder="Opponent Name">
    <div class="score" id="awayScore">0</div>
    <button class="add1" onclick="updateScore('away',1,this)">+1</button>
    <button class="add6" onclick="updateScore('away',6,this)">+6</button>
    <button class="sub" onclick="updateScore('away',-1,this)">-1</button>
  </div>

</div>

<button class="export-btn" onclick="exportScore()">Export Final Score</button>
<button class="export-btn" onclick="exportStats()">Export Game Stats</button>
<br>
<button class="reset-btn" onclick="resetGame()">Reset Game</button>

<div class="stats-box">
  <h2>Player Stats (Avispones Only)</h2>

  <input type="text" id="playerName" placeholder="Player Name">
  <button onclick="addPlayer()">Add Player</button>
  <br><br>

  <select id="playerSelect"></select>

  <div>
    <button onclick="addStat('TD',this)">+TD</button>
    <button onclick="addStat('INT',this)">+INT</button>
    <button onclick="addStat('SACK',this)">+SACK</button>
    <button onclick="addStat('XP',this)">+XP</button>
    <button onclick="addStat('TKL',this)">+TKL</button>
    <button onclick="addStat('SAF',this)">+SAFETY</button>
  </div>
</div>

<script>

let homeScore=0;
let awayScore=0;
let stats={};

function updateScore(team,value,btn){
  if(team==="home"){
    homeScore=Math.max(0,homeScore+value);
    document.getElementById("homeScore").innerText=homeScore;
  }else{
    awayScore=Math.max(0,awayScore+value);
    document.getElementById("awayScore").innerText=awayScore;
  }

  btn.classList.add("flash");
  setTimeout(()=>btn.classList.remove("flash"),250);
  if(navigator.vibrate) navigator.vibrate(40);
}

function resetGame(){
  if(confirm("Reset the game?")){
    homeScore=0;
    awayScore=0;
    stats={};
    document.getElementById("homeScore").innerText=0;
    document.getElementById("awayScore").innerText=0;
    document.getElementById("playerSelect").innerHTML="";
  }
}

function addPlayer(){
  const name=document.getElementById("playerName").value.trim();
  if(!name||stats[name]) return;

  stats[name]={TD:0,INT:0,SACK:0,XP:0,TKL:0,SAF:0};

  const option=document.createElement("option");
  option.value=name;
  option.text=name;
  document.getElementById("playerSelect").appendChild(option);

  document.getElementById("playerName").value="";
}

function addStat(type,btn){
  const player=document.getElementById("playerSelect").value;
  if(!player) return;

  stats[player][type]++;

  btn.classList.add("flash");
  setTimeout(()=>btn.classList.remove("flash"),250);
  if(navigator.vibrate) navigator.vibrate(40);
}

/* ===== SHARE FUNCTION ===== */

async function shareCanvas(canvas,fileName){
  const blob=await new Promise(resolve=>canvas.toBlob(resolve,"image/png"));
  const file=new File([blob],fileName,{type:"image/png"});

  if(navigator.canShare && navigator.canShare({files:[file]})){
    await navigator.share({files:[file],title:fileName});
  }else{
    const link=document.createElement("a");
    link.download=fileName;
    link.href=URL.createObjectURL(blob);
    link.click();
  }
}

/* ===== FINAL SCORE EXPORT ===== */

function exportScore(){
  const canvas=document.createElement("canvas");
  canvas.width=1080;
  canvas.height=1080;
  const ctx=canvas.getContext("2d");

  ctx.fillStyle="#111000";
  ctx.fillRect(0,0,1080,1080);

  ctx.fillStyle="#facc15";
  ctx.textAlign="center";
  ctx.font="bold 70px Arial";
  ctx.fillText("MARCADOR FINAL",540,400);

  ctx.font="bold 100px Arial";
  ctx.fillText("AVISPONES "+homeScore,540,550);

  const opp=document.getElementById("opponentName").value||"RIVAL";
  ctx.fillText(opp.toUpperCase()+" "+awayScore,540,680);

  shareCanvas(canvas,"avispones-final-score.PNG");
}

/* ===== STATS EXPORT ===== */

function exportStats(){
  const canvas=document.createElement("canvas");
  canvas.width=1080;
  canvas.height=1350;
  const ctx=canvas.getContext("2d");

  ctx.fillStyle="#111000";
  ctx.fillRect(0,0,1080,1350);

  ctx.fillStyle="#facc15";
  ctx.textAlign="center";

  ctx.font="bold 65px Arial";
  ctx.fillText("AVISPONES GAME STATS",540,120);

  const opp=document.getElementById("opponentName").value||"RIVAL";
  ctx.font="bold 45px Arial";
  ctx.fillText("vs "+opp.toUpperCase(),540,180);

  const cat=document.getElementById("categoryInput").value||"";
  const jorn=document.getElementById("jornadaInput").value||"";
  ctx.font="40px Arial";
  ctx.fillText(cat.toUpperCase(),540,240);
  ctx.fillText(jorn.toUpperCase(),540,280);

  let startY=340;
  const rowHeight=60;
  const statColWidth=120;
  const statColumns=["TD","INT","SACK","XP","TKL","SAF"];
  const players=Object.keys(stats);

  ctx.font="bold 32px Arial";

  let longest=ctx.measureText("PLAYER").width;
  players.forEach(p=>{
    const w=ctx.measureText(p.toUpperCase()).width;
    if(w>longest) longest=w;
  });

  const playerColWidth=longest+40;
  const totalWidth=playerColWidth+(statColumns.length*statColWidth);
  const startX=(1080-totalWidth)/2;

  ctx.strokeStyle="#facc15";

  ctx.strokeRect(startX,startY,playerColWidth,rowHeight);
  ctx.fillText("PLAYER",startX+playerColWidth/2,startY+40);

  statColumns.forEach((col,i)=>{
    const x=startX+playerColWidth+(i*statColWidth);
    ctx.strokeRect(x,startY,statColWidth,rowHeight);
    ctx.fillText(col,x+statColWidth/2,startY+40);
  });

  startY+=rowHeight;
  ctx.font="30px Arial";

  players.forEach((player,index)=>{
    const y=startY+(index*rowHeight);

    ctx.fillStyle=index%2===0?"#1a1a00":"#222200";
    ctx.fillRect(startX,y,totalWidth,rowHeight);

    const s=stats[player];
    const values=[
      player.toUpperCase(),
      s.TD||"-",
      s.INT||"-",
      s.SACK||"-",
      s.XP||"-",
      s.TKL||"-",
      s.SAF||"-"
    ];

    values.forEach((val,i)=>{
      let x,width;
      if(i===0){ x=startX;width=playerColWidth; }
      else{ x=startX+playerColWidth+((i-1)*statColWidth); width=statColWidth; }

      ctx.strokeStyle="#facc15";
      ctx.strokeRect(x,y,width,rowHeight);
      ctx.fillStyle="#facc15";
      ctx.fillText(val,x+width/2,y+40);
    });
  });

  shareCanvas(canvas,"avispones-game-stats.PNG");
}

</script>
</body>
</html>
